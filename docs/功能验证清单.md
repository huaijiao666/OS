# 操作系统课程设计 - 功能验证清单

本文档用于验证课程设计是否满足题目的所有要求。

---

## 一、题目要求对照表

### 1. 磁盘与文件组织（题目要求1）

| 序号 | 要求 | 实现情况 | 验证方法 |
|------|------|----------|----------|
| 1.1 | M×N大小的模拟磁盘（M=64B, N=1024） | ✅ 已实现 | 查看 `config.py` 中的 `BLOCK_SIZE=64`, `BLOCK_COUNT=1024` |
| 1.2 | 磁盘前部存放目录和位图信息 | ✅ 已实现 | 布局：超级块(1块)+位图(2块)+iNode(32块)+数据区 |
| 1.3 | 目录采用文件名+iNode形式 | ✅ 已实现 | 查看 `filesystem.py` 中的 `DirectoryEntry` 结构 |
| 1.4 | 数据组织采用混合索引方式 | ✅ 已实现 | 6个直接索引+1个一级间接+1个二级间接 |
| 1.5 | 空闲块管理采用位示图法 | ✅ 已实现 | 查看 `disk.py` 中的位图操作函数 |
| 1.6 | 文件操作采用非阻塞I/O方式 | ✅ 已实现 | `open_file()` 返回 `would_block` 标志而非等待 |

### 2. 文件接口（题目要求2）

| 序号 | 要求 | 实现情况 | 验证命令 |
|------|------|----------|----------|
| 2.1 | 新建文件 | ✅ 已实现 | `touch filename` 或 `echo content > filename` |
| 2.2 | 查询目录 | ✅ 已实现 | `ls` 命令显示文件名、时间、块数等 |
| 2.3 | 查看文件内容 | ✅ 已实现 | `cat filename` 查看完整内容 |
| 2.4 | 查看指定盘块内容 | ✅ 已实现 | `hexdump 块号` 查看块的十六进制内容 |
| 2.5 | 修改文件内容 | ✅ 已实现 | `echo newcontent > filename` 覆盖写入 |
| 2.6 | 删除文件 | ✅ 已实现 | `rm filename` 删除文件并释放块 |
| 2.7 | 文件保护（正在操作时阻止删除） | ✅ 已实现 | `open`后`rm`会失败，`close`后可删除 |

### 3. 内存缓冲页（题目要求3）

| 序号 | 要求 | 实现情况 | 验证方法 |
|------|------|----------|----------|
| 3.1 | M×K大小缓冲区（K=16） | ✅ 已实现 | 查看 `config.py` 中 `BUFFER_PAGE_COUNT=16` |
| 3.2 | 记录每个缓冲页的所有者 | ✅ 已实现 | `BufferPage.owner_process` 字段 |
| 3.3 | 记录访问时间 | ✅ 已实现 | `BufferPage.access_time` 字段 |
| 3.4 | 记录是否修改 | ✅ 已实现 | `PageState.DIRTY` 状态 |
| 3.5 | 缓冲页置换（LRU） | ✅ 已实现 | `_find_victim_lru()` 函数 |
| 3.6 | 脏页写回磁盘 | ✅ 已实现 | 置换时自动写回，或执行 `sync` 命令 |

### 4. 进程同步与互斥（题目要求4）

| 序号 | 要求 | 实现情况 | 验证方法 |
|------|------|----------|----------|
| 4.1 | 每个命令作为单独进程 | ✅ 已实现 | 每个命令创建新进程，可用 `ps` 查看 |
| 4.2 | 进程通信采用共享内存 | ✅ 已实现 | `shmget`, `shmwrite`, `shmread` 命令 |
| 4.3 | 进程同步采用条件变量 | ✅ 已实现 | 共享内存读写使用条件变量同步 |
| 4.4 | 进程调度采用时间片轮转RR | ✅ 已实现 | `RRScheduler` 类实现，可调节时间片 |

### 5. 可视化（题目要求5）

| 序号 | 要求 | 实现情况 | 验证方法 |
|------|------|----------|----------|
| 5.1 | 内存缓冲可视化 | ✅ 已实现 | "缓冲区"面板显示16个页面状态 |
| 5.2 | 磁盘信息可视化 | ✅ 已实现 | "磁盘"面板显示1024个块的位图 |
| 5.3 | 目录信息可视化 | ✅ 已实现 | "文件"面板显示目录树 |
| 5.4 | 动态刷新 | ✅ 已实现 | 使用WebSocket实时更新 |
| 5.5 | I/O过程延时便于观察 | ✅ 已实现 | `IO_DELAY=0.3秒/块` |
| 5.6 | 换页过程延时便于观察 | ✅ 已实现 | `PAGE_SWAP_DELAY=0.5秒/页` |

---

## 二、快速验证脚本

在终端面板中依次执行以下命令，可以快速验证所有功能：

### 验证磁盘和文件系统

```bash
# 1. 查看磁盘状态
df

# 2. 查看文件系统信息
dumpe2fs

# 3. 创建文件
touch test1.txt
echo "Hello World" > test1.txt

# 4. 查看目录
ls

# 5. 查看文件内容
cat test1.txt

# 6. 查看文件信息
stat test1.txt

# 7. 查看iNode
inode 1
```

### 验证缓冲区

```bash
# 1. 查看缓冲区状态
free

# 2. 多次读取同一文件触发缓存命中
cat test1.txt
cat test1.txt
cat test1.txt

# 3. 再次查看缓冲区，观察命中率
free

# 4. 刷新缓冲区
sync
```

### 验证进程调度

```bash
# 1. 启动调度器
scheduler start

# 2. 查看调度状态
top

# 3. 创建长任务
nice task1 3
nice task2 5

# 4. 批量创建
batch 3

# 5. 观察调度
ps
top

# 6. 调整时间片
scheduler quantum 50
```

### 验证共享内存

```bash
# 1. 查看IPC资源
ipcs

# 2. 创建共享内存
shmget 256

# 3. 写入数据
shmwrite 1 "Test Data"

# 4. 读取数据
shmread 1

# 5. 查看IPC资源
ipcs

# 6. 删除
ipcrm 1
```

### 验证文件保护

```bash
# 1. 创建文件
touch protected.txt

# 2. 打开文件（加锁）
open protected.txt

# 3. 尝试删除（应失败）
rm protected.txt

# 4. 关闭文件（解锁）
close protected.txt

# 5. 再次删除（应成功）
rm protected.txt
```

### 验证目录操作

```bash
# 1. 创建目录
mkdir mydir

# 2. 进入目录
cd mydir

# 3. 显示当前路径
pwd

# 4. 在子目录创建文件
touch subfile.txt

# 5. 列出内容
ls

# 6. 返回上级
cd ..
```

---

## 三、核心源码验证

### 3.1 配置文件 (config.py)

验证以下配置是否正确：

```python
BLOCK_SIZE = 64          # M=64B
BLOCK_COUNT = 1024       # N=1024
BUFFER_PAGE_COUNT = 16   # K=16
TIME_QUANTUM = 100       # 时间片=100ms
IO_DELAY = 0.3           # I/O延时
PAGE_SWAP_DELAY = 0.5    # 换页延时
```

### 3.2 位图管理 (disk.py)

验证位图分配函数：

```python
def allocate_block(self) -> Optional[int]:
    """分配空闲块（位图法）"""
    # 使用位图查找空闲块
```

### 3.3 混合索引 (filesystem.py)

验证索引结构：

```python
DIRECT_BLOCKS = 6        # 6个直接索引
SINGLE_INDIRECT = 1      # 1个一级间接
DOUBLE_INDIRECT = 1      # 1个二级间接
```

### 3.4 LRU置换 (buffer.py)

验证LRU算法：

```python
def _find_victim_lru(self) -> Optional[int]:
    """选择最久未使用的页面"""
```

### 3.5 时间片轮转 (scheduler.py)

验证RR调度器：

```python
class RRScheduler:
    """时间片轮转调度器"""
    def _scheduler_loop(self):
        """调度主循环"""
```

### 3.6 条件变量同步 (ipc.py)

验证共享内存同步：

```python
class SharedMemorySegment:
    def __init__(self):
        self.condition = threading.Condition()
```

---

## 四、最终检查

在提交前，请确认：

- [ ] 后端可以正常启动，无报错
- [ ] 前端可以正常访问
- [ ] 所有命令都可以正确执行
- [ ] 可视化面板正常显示和更新
- [ ] 进度延时可以观察到
- [ ] 进程调度可以正常工作
- [ ] 共享内存通信正常
- [ ] 文件保护功能正常

---

## 五、实现亮点

1. **完整的Web可视化界面**：使用React + TypeScript开发，实时显示系统状态
2. **WebSocket实时通信**：使用Socket.IO实现前后端实时通信
3. **规范的代码结构**：模块化设计，符合软件工程规范
4. **丰富的命令支持**：支持20+种终端命令
5. **详细的日志记录**：记录所有操作事件，便于调试和演示
6. **可配置的延时**：I/O和换页延时可调节，便于观察

