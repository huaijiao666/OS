# 操作系统课程设计 - 演示指南

本文档详细说明如何演示课程设计的所有功能，确保能够完整展示系统的各个模块。

> **提示**：更详细的界面说明请参阅《可视化界面详解.md》

---

## 零、可视化界面操作演示

### 0.1 磁盘面板操作

**进入方式**：点击左侧导航栏"磁盘"按钮

**演示步骤**：
1. 观察磁盘位图的颜色分区（蓝色超级块、绿色位图、紫色iNode、灰色空闲）
2. 在终端创建文件：`echo "Hello" > test.txt`
3. 回到磁盘面板，点击"刷新"按钮
4. 观察：有灰色块变成橙色（已使用）
5. 点击橙色块，查看块内容（十六进制和文本）
6. 点击"iNode列表"标签，查看新增的iNode
7. 点击iNode，查看详细信息（直接索引块列表等）

**变化含义**：
- 灰色→橙色：磁盘块被分配给文件
- iNode列表增加条目：新文件的元数据被创建

### 0.2 缓冲区面板操作

**进入方式**：点击左侧导航栏"缓冲区"按钮

**演示步骤**：
1. 观察16个缓冲页的初始状态（大部分为FREE灰色）
2. 在终端执行：`cat test.txt`
3. 回到缓冲区面板，观察：
   - 出现CLEAN(绿色)页面
   - "未命中"次数+1
4. 再次执行：`cat test.txt`（重复2-3次）
5. 观察：
   - "命中次数"增加
   - 命中率从0%提升
6. 执行：`echo "Modified" > test.txt`
7. 观察：出现DIRTY(红色)页面
8. 点击"写回脏页"按钮
9. 观察：红色页变为绿色，"写回次数"+1

**变化含义**：
- FREE→CLEAN：数据从磁盘加载到缓冲区
- CLEAN→DIRTY：缓冲区数据被修改
- DIRTY→CLEAN：脏页写回磁盘

### 0.3 进程面板操作

**进入方式**：点击左侧导航栏"进程"按钮

**演示步骤**：
1. 观察进程状态转换图（五态模型）
2. 点击"创建测试进程(ls)"按钮
3. 观察进程列表新增一行
4. 观察状态变化：NEW→READY→RUNNING→TERMINATED
5. 多次创建进程，观察各状态计数变化

**状态含义**：
- NEW(灰色)：进程刚创建
- READY(橙色)：等待CPU
- RUNNING(绿色)：正在执行
- BLOCKED(红色)：等待I/O
- TERMINATED(深灰)：已完成

### 0.4 调度器面板操作

**进入方式**：点击左侧导航栏"调度器"按钮

**演示步骤**：
1. 点击"启动"按钮启动调度器
2. 观察状态从STOPPED变为RUNNING
3. 点击"创建单个任务"按钮
4. 观察就绪队列出现新PID
5. 点击"批量创建(3个)"按钮
6. 观察：
   - 就绪队列显示多个PID
   - "当前进程"在不同PID间切换
   - "上下文切换"数字增加
   - "抢占次数"数字增加
   - 调度事件日志显示dispatch/preempt事件
7. 调整时间片为50ms，点击"设置"
8. 观察：进程切换更频繁
9. 调整时间片为500ms
10. 观察：每个进程运行更长时间

**关于"演示任务"（longtask）说明**：
- 创建的任务命令类型为"演示任务"（内部类型longtask）
- 这些是专门用于演示调度算法的模拟任务
- 任务会持续指定时间，期间被调度器调度

---

## 一、启动系统

### 1.1 启动后端服务

```bash
cd F:\all\CZXT\课设\OS\backend
python app.py
```

预期输出：
```
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.x.x:5000
WebSocket server started
```

### 1.2 启动前端服务

打开新的终端：
```bash
cd F:\all\CZXT\课设\OS\frontend
npm run dev
```

预期输出：
```
  VITE v5.x.x  ready in xxx ms
  ➜  Local:   http://localhost:5173/
```

### 1.3 访问系统

打开浏览器访问：**http://localhost:5173**

---

## 二、功能演示流程

按照以下顺序演示，可以完整展示所有功能点：

### 演示1：磁盘与文件组织（题目要求1）

#### 1.1 查看磁盘布局

1. 点击左侧导航栏的 **"磁盘"** 按钮
2. 观察磁盘位图的颜色分区：
   - 蓝色：超级块（块0）
   - 绿色：位图区（块1-2）
   - 紫色：iNode区（块3-34）
   - 灰色：空闲数据块
   - 红色/橙色：已使用数据块
3. 截图保存为【图6-3 磁盘位图截图】

**演示话术**：
> "这是我们模拟的64KB磁盘，由1024个64字节的块组成。前35个块用于元数据管理，包括超级块、位图和iNode区，后面989个块用于存储数据。"

#### 1.2 查看位图管理

在终端中执行：
```bash
df
```

观察输出的磁盘使用情况，包括总块数、已用块数、空闲块数。

#### 1.3 查看iNode结构

1. 在磁盘面板点击 **"iNode列表"** 标签
2. 点击任意一个iNode条目
3. 观察iNode详情：
   - 文件类型、权限、大小
   - 创建时间、修改时间
   - 直接索引块列表
   - 一级/二级间接索引

**演示话术**：
> "每个iNode占用64字节，包含文件的元数据信息。我们采用混合索引方式，支持6个直接索引、1个一级间接索引和1个二级间接索引，最大可支持约66KB的文件。"

---

### 演示2：文件接口操作（题目要求2）

切换到 **"终端"** 面板，依次执行：

#### 2.1 新建文件

```bash
touch demo.txt
echo "Hello, OS Course Design!" > demo.txt
```

观察：磁盘面板中会有新的块变为已使用状态

#### 2.2 查询目录

```bash
ls
stat demo.txt
```

**演示话术**：
> "stat命令显示文件的详细信息，包括iNode号、类型、权限、大小和时间戳。"

#### 2.3 查看文件内容

```bash
cat demo.txt
```

#### 2.4 修改文件内容

```bash
echo "New content" > demo.txt
cat demo.txt
```

或追加内容：
```bash
echo " - Appended text" >> demo.txt
cat demo.txt
```

#### 2.5 创建多级目录

```bash
mkdir projects
cd projects
touch project1.txt
echo "Project 1 content" > project1.txt
ls
pwd
cd ..
ls
```

#### 2.6 文件保护演示

```bash
touch protected.txt
open protected.txt
rm protected.txt
```

观察：会显示"文件正在使用，无法删除"

```bash
close protected.txt
rm protected.txt
```

观察：文件成功删除

#### 2.7 删除文件

```bash
touch todelete.txt
rm todelete.txt
```

观察：磁盘面板中对应的块变回空闲状态

---

### 演示3：内存缓冲页（题目要求3）

切换到 **"缓冲区"** 面板

#### 3.1 观察缓冲页状态

1. 查看16个缓冲页的状态：
   - FREE（绿色）：空闲
   - CLEAN（蓝色）：干净（与磁盘一致）
   - DIRTY（红色）：脏页（已修改未写回）

2. 观察缓冲区统计信息：
   - 命中次数
   - 未命中次数
   - 置换次数
   - 写回次数
   - 命中率

#### 3.2 触发缓存命中

在终端执行：
```bash
cat demo.txt
cat demo.txt
cat demo.txt
```

观察：命中次数增加，命中率提高

**演示话术**：
> "当我们重复读取同一文件时，数据会从缓冲区直接返回，无需再次访问磁盘，这就是缓存命中。可以看到命中率从0%逐渐提升。"

#### 3.3 触发页面置换

创建多个文件触发置换：
```bash
touch file1.txt
echo "content1" > file1.txt
touch file2.txt
echo "content2" > file2.txt
# ... 继续创建更多文件
```

或使用批量创建命令

观察：置换次数增加，可以在缓冲区面板看到页面被替换

#### 3.4 手动刷新缓冲区

```bash
sync
```

观察：所有DIRTY页面变为CLEAN，写回次数增加

---

### 演示4：进程调度（题目要求4）

#### 4.1 查看进程列表

切换到 **"进程"** 面板，或在终端执行：
```bash
ps
```

观察：显示所有进程及其状态（NEW/READY/RUNNING/BLOCKED/TERMINATED）

#### 4.2 启动调度器

切换到 **"调度器"** 面板

1. 如果调度器未启动，点击 **"启动调度器"** 按钮
2. 或在终端执行：
```bash
scheduler start
```

#### 4.3 创建长任务观察调度

```bash
nice task1 3
nice task2 5
nice task3 2
```

观察：
- 就绪队列中出现这些任务
- 调度器按时间片轮转执行
- 上下文切换次数增加
- 抢占次数增加

**演示话术**：
> "这里我们创建了三个需要不同执行时间的任务。调度器采用时间片轮转算法，每个进程执行100毫秒后被抢占，放到队列尾部，让下一个进程运行。"

#### 4.4 批量创建任务

```bash
batch 5
```

观察：一次性创建5个任务，观察调度过程

#### 4.5 调整时间片

```bash
scheduler quantum 200
```

观察：时间片变为200毫秒，每个进程运行更长时间才被抢占

#### 4.6 查看调度统计

```bash
top
```

观察输出：
- CPU利用率
- 上下文切换次数
- 抢占次数
- 总调度次数

---

### 演示5：进程间通信-共享内存（题目要求4b-4c）

#### 5.1 查看IPC资源

```bash
ipcs
```

#### 5.2 创建共享内存

```bash
shmget 256
```

观察：创建了key为1的256字节共享内存段

#### 5.3 写入共享内存

```bash
shmwrite 1 "Hello from Process A"
```

#### 5.4 读取共享内存

```bash
shmread 1
```

观察：输出"Hello from Process A"

**演示话术**：
> "共享内存是进程间通信的一种高效方式。我们使用条件变量来同步读写操作，确保数据一致性。写操作时会阻塞其他写者，读操作可以并发进行。"

#### 5.5 删除共享内存

```bash
ipcrm 1
ipcs
```

---

### 演示6：可视化延时观察（题目要求5）

#### 6.1 观察I/O延时

创建一个较大的文件：
```bash
echo "This is a test file with multiple blocks of content that will take multiple disk blocks to store" > bigfile.txt
```

观察：
- 终端中会显示写入进度 "正在写入块 1/3..."
- 每个块之间有明显延时（约0.3秒）
- 可以在磁盘面板看到块逐个变色

**演示话术**：
> "为了便于观察I/O过程，我们在每个块操作之间加入了延时。可以看到文件内容是分块写入磁盘的，这模拟了真实磁盘I/O的特性。"

#### 6.2 观察页面置换延时

连续读取多个不同文件，当缓冲区满时触发置换：

观察：
- 缓冲区面板显示置换过程
- 脏页写回有明显延时（约0.5秒）

---

### 演示7：高级磁盘操作

#### 7.1 查看块内容

```bash
hexdump 35
```

观察：显示数据块的十六进制内容

#### 7.2 查看文件系统信息

```bash
dumpe2fs
```

观察：显示文件系统详细配置

#### 7.3 格式化磁盘（慎用）

```bash
mkfs --force
```

观察：所有数据被清除，磁盘恢复初始状态

---

## 三、功能对照表

| 题目要求 | 实现功能 | 演示命令 | 验证方法 |
|---------|---------|---------|---------|
| M×N模拟磁盘 | 64B×1024块 | `df` | 查看磁盘面板 |
| 目录（iNode形式）| 单级+多级目录 | `ls`, `mkdir`, `cd` | 目录操作 |
| 混合索引 | 6直接+间接+双间接 | `inode 0` | 查看iNode详情 |
| 位示图法 | 位图管理空闲块 | 磁盘面板 | 观察位图变化 |
| 非阻塞I/O | 文件打开立即返回 | `open`, `close` | 文件锁测试 |
| 文件操作 | 创建/读/写/删除 | `touch`, `cat`, `echo`, `rm` | 完整操作 |
| 缓冲页分配 | 16页缓冲区 | `free` | 缓冲区面板 |
| LRU置换 | 最久未使用置换 | 多次读写 | 观察置换日志 |
| 命令进程 | 每命令创建进程 | `ps` | 进程列表 |
| 共享内存 | IPC通信 | `shmget`, `shmwrite`, `shmread` | 数据传递 |
| 条件变量 | 读写同步 | 共享内存操作 | 并发测试 |
| 时间片轮转 | RR调度 | `nice`, `batch`, `top` | 调度面板 |
| 可视化 | Web界面 | 各面板 | 动态刷新 |
| I/O延时 | 0.3秒/块 | 文件操作 | 观察进度 |
| 换页延时 | 0.5秒/页 | 触发置换 | 观察延时 |

---

## 四、截图清单

以下是课设报告中需要手动截取的截图：

| 编号 | 图片名称 | 截图内容 | 操作步骤 |
|-----|---------|---------|---------|
| 图5-1 | 系统主界面 | 完整的系统界面 | 启动后截取首页 |
| 图6-1 | 文件创建测试 | 终端文件操作 | 执行touch, echo, cat, stat |
| 图6-2 | 目录操作测试 | 终端目录操作 | 执行mkdir, cd, ls |
| 图6-3 | 磁盘位图 | 磁盘面板位图区 | 点击磁盘面板，创建文件后截图 |
| 图6-4 | iNode详情 | iNode列表和详情 | 点击iNode查看详情 |
| 图6-5 | 缓冲区状态 | 缓冲区面板 | 多次cat同一文件后截图 |
| 图6-6 | 置换日志 | 缓冲区置换记录 | 触发置换后截图 |
| 图6-7 | 调度器面板 | 调度器状态和事件 | 创建多个任务后截图 |
| 图6-8 | 共享内存测试 | 终端IPC命令 | 执行ipcs, shmget, shmwrite, shmread |
| 图6-9 | 文件保护测试 | 终端锁定测试 | 演示open后rm失败 |

---

## 五、需要AI生成的图片

以下图片需要使用AI绘图工具生成，可使用 Midjourney、DALL-E 或其他工具：

### 图2-1 系统功能模块图

**图片要求**：
- 层次结构图，顶层为"文件系统模拟器"
- 包含7个子模块：虚拟磁盘、文件系统、缓冲区、进程管理、调度器、IPC、Web可视化
- 白色背景，蓝色方框，黑色连线

**AI绘图Prompt**:
```
Create a hierarchical system architecture diagram with white background. The top box is labeled "File System Simulator" in Chinese "文件系统模拟器". Below it are 7 child boxes arranged horizontally: "Virtual Disk 虚拟磁盘", "File System 文件系统", "Buffer Manager 缓冲区", "Process Manager 进程管理", "Scheduler 调度器", "IPC Module IPC模块", "Web Visualization Web可视化". Use blue rectangular boxes with black borders, connected by black lines. Clean, professional technical diagram style. No gradients or shadows.
```

---

### 图2-2 系统主流程图

**图片要求**：
- 标准流程图，使用椭圆（开始/结束）、矩形（处理）、菱形（判断）
- 包含：开始→初始化→启动→等待命令→解析→创建进程→调度→返回结果→循环
- 白色背景

**AI绘图Prompt**:
```
Create a flowchart diagram with white background. Standard flowchart symbols: oval for start/end, rectangles for processes, diamonds for decisions. Flow: Start (开始) -> Initialize Disk (初始化磁盘) -> Load FileSystem (加载文件系统) -> Start Scheduler (启动调度器) -> Wait for Command (等待命令) -> Parse Command (解析命令) -> Create Process (创建进程) -> Add to Queue (加入队列) -> Schedule & Execute (调度执行) -> Return Result (返回结果) -> loop back to Wait for Command. Black arrows connecting elements. Clean professional style, no shadows.
```

---

### 图3-1 iNode结构示意图

**图片要求**：
- 水平条形图，显示64字节的iNode结构
- 按偏移量划分各字段
- 标注每个字段的偏移量和大小

**AI绘图Prompt**:
```
Create a data structure layout diagram showing a 64-byte iNode structure. White background. Horizontal bar divided into labeled sections with byte offsets: iNode ID (0-1, 2 bytes), Type (2, 1 byte), Permissions (3, 1 byte), File Size (4-7, 4 bytes), Create Time (8-15, 8 bytes), Modify Time (16-23, 8 bytes), Link Count (24-25, 2 bytes), Direct Blocks (26-37, 12 bytes), Single Indirect (38-39, 2 bytes), Double Indirect (40-41, 2 bytes), Reserved (42-63, 22 bytes). Use alternating light colors for each section. Clean technical diagram style with clear labels.
```

---

### 图3-2 混合索引结构图

**图片要求**：
- 展示iNode的索引结构
- 包含直接索引（6个）、一级间接索引、二级间接索引
- 箭头指向数据块

**AI绘图Prompt**:
```
Create a file system hybrid indexing diagram with white background. Left side shows an iNode box with arrows pointing to: 6 direct data blocks on the right, a single indirect block (which then points to 32 data blocks), and a double indirect block (which points to intermediate blocks, then to more data blocks). Use blue boxes for iNode and indirect blocks, green boxes for data blocks. Black arrows with labels. Clean professional technical diagram style.
```

---

### 图3-3 函数调用关系图

**图片要求**：
- 树形结构，顶层为app.py
- 分支到各个模块及其函数
- 白色背景

**AI绘图Prompt**:
```
Create a function call hierarchy diagram with white background. Tree structure starting from "app.py" at top. Branches to 5 main modules: FileSystem (with sub-functions: create_file, read_file, delete_file), BufferManager (with: get_page, read_page, write_page), ProcessManager (with: create_process, execute_process), Scheduler (with: start, stop, _scheduler_loop), SharedMemoryManager (with: create, read, write). Black lines connecting nodes. Clean professional style, organized layout.
```

---

## 六、常见问题

### Q1: 后端启动报错 "Address already in use"
**解决**：端口5000被占用，可以修改`app.py`中的端口号，或终止占用进程

### Q2: 前端无法连接后端
**解决**：检查后端是否正常启动，检查CORS配置

### Q3: 磁盘文件损坏
**解决**：在终端执行 `mkfs --force` 重新格式化

### Q4: 缓冲区统计不准确
**解决**：执行 `sync` 刷新缓冲区，然后刷新页面

---

## 七、演示时间安排建议

| 时间 | 内容 |
|------|------|
| 0-2分钟 | 系统启动和界面介绍 |
| 2-5分钟 | 磁盘和文件系统演示 |
| 5-8分钟 | 文件操作命令演示 |
| 8-10分钟 | 缓冲区和页面置换演示 |
| 10-12分钟 | 进程调度演示 |
| 12-14分钟 | 共享内存通信演示 |
| 14-15分钟 | 总结和提问 |

---

## 八、演示检查清单

演示前请确认：

- [ ] 后端服务正常启动（终端无报错）
- [ ] 前端服务正常启动（可访问页面）
- [ ] 磁盘文件状态正常（或已格式化）
- [ ] 所有面板可正常切换
- [ ] WebSocket连接正常（页面右上角无断开提示）
- [ ] 浏览器开发者工具无严重错误

