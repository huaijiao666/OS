# 文件系统模拟器 - 用户手册

## 目录

1. [系统简介](#1-系统简介)
2. [安装配置](#2-安装配置)
3. [界面说明](#3-界面说明)
4. [命令参考](#4-命令参考)
5. [常见问题](#5-常见问题)

---

## 1. 系统简介

本系统是一个基于Web的操作系统文件系统模拟器，用于演示和学习操作系统核心概念：

- **虚拟磁盘**：64KB模拟磁盘（64B×1024块）
- **文件系统**：支持目录和文件的创建、读写、删除
- **内存缓冲**：16页缓冲区，LRU页面置换算法
- **进程调度**：时间片轮转（RR）调度算法
- **IPC通信**：共享内存通信，条件变量同步

---

## 2. 安装配置

### 2.1 系统要求

- Python 3.8 或更高版本
- Node.js 16 或更高版本
- 现代浏览器（Chrome、Firefox、Edge）

### 2.2 安装步骤

#### 步骤1：安装后端依赖

```bash
cd backend
pip install flask flask-cors flask-socketio
```

#### 步骤2：安装前端依赖

```bash
cd frontend
npm install
```

### 2.3 启动系统

#### 启动后端（终端1）

```bash
cd backend
python app.py
```

成功启动后显示：
```
 * Running on http://127.0.0.1:5000
 * WebSocket server started
```

#### 启动前端（终端2）

```bash
cd frontend
npm run dev
```

成功启动后显示：
```
  VITE v5.x.x  ready
  ➜  Local:   http://localhost:5173/
```

#### 访问系统

打开浏览器，访问 **http://localhost:5173**

---

## 3. 界面说明

### 3.1 主界面布局

```
┌──────────────────────────────────────────────────┐
│                    顶部状态栏                      │
├─────────┬────────────────────────────────────────┤
│         │                                        │
│         │                                        │
│  导航栏  │              主内容区域                 │
│         │                                        │
│         │                                        │
└─────────┴────────────────────────────────────────┘
```

### 3.2 导航栏按钮

| 图标 | 名称 | 功能描述 |
|-----|------|----------|
| 📊 | 仪表盘 | 系统状态总览，显示各模块摘要信息 |
| 📁 | 文件 | 文件资源管理器，图形化文件操作 |
| 💾 | 磁盘 | 磁盘可视化，查看位图、iNode、块内容 |
| 📋 | 缓冲区 | 缓冲页状态，查看命中率和置换情况 |
| ⚙️ | 进程 | 进程列表，查看所有进程状态 |
| 🕐 | 调度器 | 调度器控制面板，管理进程调度 |
| 💻 | 终端 | 命令行界面，执行各种系统命令 |

### 3.3 磁盘面板

#### 位图视图
- **蓝色块**：超级块（块0）
- **绿色块**：位图区（块1-2）
- **紫色块**：iNode区（块3-34）
- **灰色块**：空闲数据块
- **橙色/红色块**：已使用数据块

#### iNode列表
点击"iNode列表"标签查看所有活动的iNode，包括：
- iNode ID
- 文件类型（目录/文件）
- 文件大小
- 分配的块数

### 3.4 缓冲区面板

显示16个缓冲页的状态：
- **FREE**（绿色）：空闲页面
- **CLEAN**（蓝色）：干净页面（与磁盘一致）
- **DIRTY**（红色）：脏页（已修改未写回）

底部显示统计信息：
- 命中次数 / 未命中次数
- 置换次数 / 写回次数
- 命中率

### 3.5 调度器面板

- **控制按钮**：启动/停止/暂停/恢复调度器
- **就绪队列**：等待执行的进程列表
- **当前进程**：正在运行的进程
- **调度事件**：历史调度事件日志
- **统计信息**：上下文切换、抢占次数、CPU利用率

---

## 4. 命令参考

### 4.1 文件操作命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| ls | `ls` | 列出当前目录内容 | `ls` |
| cat | `cat <文件名>` | 显示文件内容 | `cat test.txt` |
| touch | `touch <文件名>` | 创建空文件 | `touch new.txt` |
| echo | `echo <内容> > <文件>` | 写入文件（覆盖）| `echo Hello > a.txt` |
| echo | `echo <内容> >> <文件>` | 追加到文件 | `echo World >> a.txt` |
| rm | `rm <文件名>` | 删除文件 | `rm old.txt` |
| stat | `stat <文件名>` | 显示文件详细信息 | `stat test.txt` |
| open | `open <文件名>` | 打开文件（加锁）| `open test.txt` |
| close | `close <文件名>` | 关闭文件（解锁）| `close test.txt` |

### 4.2 目录操作命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| pwd | `pwd` | 显示当前目录 | `pwd` |
| cd | `cd <目录>` | 切换目录 | `cd subdir` |
| cd | `cd ..` | 返回上级目录 | `cd ..` |
| mkdir | `mkdir <目录名>` | 创建目录 | `mkdir mydir` |

### 4.3 磁盘管理命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| df | `df` | 显示磁盘使用情况 | `df` |
| hexdump | `hexdump <块号>` | 查看块的十六进制内容 | `hexdump 35` |
| inode | `inode <iNode号>` | 查看iNode详细信息 | `inode 0` |
| inodes | `inodes` | 列出所有活动iNode | `inodes` |
| mkfs | `mkfs --force` | 格式化磁盘 | `mkfs --force` |
| dumpe2fs | `dumpe2fs` | 显示文件系统信息 | `dumpe2fs` |

### 4.4 缓冲区命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| free | `free` | 显示缓冲区状态 | `free` |
| sync | `sync` | 刷新所有脏页到磁盘 | `sync` |

### 4.5 进程命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| ps | `ps` | 显示进程列表 | `ps` |
| top | `top` | 显示调度器状态 | `top` |
| nice | `nice <名称> <时长>` | 创建后台任务 | `nice task1 5` |
| batch | `batch <数量>` | 批量创建任务 | `batch 3` |
| kill | `kill <PID>` | 终止进程 | `kill 5` |

### 4.6 调度器命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| scheduler start | `scheduler start` | 启动调度器 | `scheduler start` |
| scheduler stop | `scheduler stop` | 停止调度器 | `scheduler stop` |
| scheduler pause | `scheduler pause` | 暂停调度器 | `scheduler pause` |
| scheduler resume | `scheduler resume` | 恢复调度器 | `scheduler resume` |
| scheduler quantum | `scheduler quantum <ms>` | 设置时间片 | `scheduler quantum 200` |

### 4.7 IPC命令

| 命令 | 格式 | 说明 | 示例 |
|------|------|------|------|
| ipcs | `ipcs` | 显示IPC资源 | `ipcs` |
| shmget | `shmget <大小>` | 创建共享内存 | `shmget 256` |
| shmwrite | `shmwrite <key> <数据>` | 写入共享内存 | `shmwrite 1 Hello` |
| shmread | `shmread <key>` | 读取共享内存 | `shmread 1` |
| ipcrm | `ipcrm <key>` | 删除共享内存 | `ipcrm 1` |

### 4.8 其他命令

| 命令 | 说明 |
|------|------|
| help | 显示帮助信息 |
| clear | 清空终端 |

---

## 5. 常见问题

### Q1: 启动后端时报错 "Address already in use"

**原因**：端口5000被其他程序占用

**解决方法**：
1. 找到占用端口的程序并关闭
2. 或修改 `backend/app.py` 中的端口号

### Q2: 前端页面无法连接后端

**原因**：后端未启动或CORS配置问题

**解决方法**：
1. 确认后端已正常启动
2. 检查后端控制台是否有错误
3. 刷新前端页面

### Q3: 文件无法删除，提示"文件正在使用"

**原因**：文件被open命令锁定

**解决方法**：
```bash
close <文件名>
rm <文件名>
```

### Q4: 磁盘显示异常

**原因**：磁盘文件损坏

**解决方法**：
```bash
mkfs --force
```
注意：此操作会清除所有数据

### Q5: 缓冲区命中率为0

**原因**：首次访问文件必定未命中

**解决方法**：多次访问同一文件，命中率会逐渐提升

### Q6: 创建的进程没有被调度

**原因**：调度器未启动

**解决方法**：
```bash
scheduler start
```
或在调度器面板点击"启动调度器"按钮

---

## 附录：快捷操作

### 文件快速操作流程

```bash
# 创建并写入文件
touch myfile.txt
echo "Hello World" > myfile.txt

# 查看文件
cat myfile.txt
stat myfile.txt

# 修改文件
echo "New Content" > myfile.txt

# 删除文件
rm myfile.txt
```

### 进程调度演示流程

```bash
# 启动调度器
scheduler start

# 创建多个任务
nice task1 3
nice task2 5
nice task3 2

# 观察调度
top

# 调整时间片
scheduler quantum 50

# 停止调度器
scheduler stop
```

### 共享内存使用流程

```bash
# 查看现有IPC资源
ipcs

# 创建共享内存
shmget 1024

# 写入数据
shmwrite 1 "Hello from Process A"

# 读取数据
shmread 1

# 清理
ipcrm 1
```

