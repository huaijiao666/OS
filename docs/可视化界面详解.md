# 操作系统课程设计 - 可视化界面详解

本文档详细说明每个可视化面板的功能、操作方法和变化含义。

---

## 一、系统界面概览

系统采用单页面应用（SPA）架构，左侧为导航栏，右侧为内容区域。

### 1.1 导航栏按钮

| 图标 | 名称 | 功能描述 | 对应题目要求 |
|------|------|----------|-------------|
| 📊 | 仪表盘 | 显示系统状态摘要 | 可视化总览 |
| 📁 | 文件 | 图形化文件管理器 | 目录可视化 |
| 💾 | 磁盘 | 磁盘位图和iNode可视化 | 磁盘信息可视化 |
| 📋 | 缓冲区 | 内存缓冲页状态显示 | 内存缓冲可视化 |
| ⚙️ | 进程 | 进程列表和状态图 | 进程调度可视化 |
| 🕐 | 调度器 | 调度器控制和事件 | 时间片轮转可视化 |
| 💻 | 终端 | 命令行界面 | 完整功能操作 |

---

## 二、磁盘面板详解

### 2.1 面板位置
点击左侧导航栏的"磁盘"按钮进入。

### 2.2 磁盘位图视图

**界面组成：**
- 顶部信息栏：显示总容量(64KB)、块大小(64B)、总块数(1024)、已使用块数、iNode数量
- 图例栏：说明各颜色含义
- 位图网格：1024个小方块，每个代表一个磁盘块
- 详情区：点击块后显示详细内容

**颜色含义：**

| 颜色 | 含义 | 块号范围 | 说明 |
|------|------|---------|------|
| 🔵 蓝色 | 超级块 | 块 0 | 存储文件系统元信息 |
| 🟢 绿色 | 位图区 | 块 1-2 | 空闲块管理位图 |
| 🟣 紫色 | iNode区 | 块 3-34 | 文件元数据存储 |
| 🔴 橙/红色 | 已使用数据块 | 块 35+ | 存储文件内容 |
| ⬜ 灰色 | 空闲数据块 | 块 35+ | 未使用的数据块 |

**操作方法：**
1. **查看块详情**：点击任意方块，底部显示该块的十六进制和文本内容
2. **刷新位图**：点击右上角"刷新"按钮
3. **切换视图**：点击"iNode列表"标签查看iNode

**变化含义：**
- 创建文件时：灰色块变为橙色（分配数据块）
- 删除文件时：橙色块变回灰色（释放数据块）
- 修改文件时：如果文件变大，可能分配更多块

### 2.3 iNode列表视图

点击"iNode列表"标签进入。

**界面组成：**
- iNode卡片网格：每个卡片显示一个活动的iNode
- iNode详情区：点击卡片后显示详细信息

**iNode详情说明：**

| 字段 | 含义 |
|------|------|
| 类型 | DIRECTORY(目录) 或 FILE(普通文件) |
| 权限 | rwx格式，如"rw-"表示可读写不可执行 |
| 大小 | 文件内容字节数 |
| 链接数 | 指向该iNode的目录项数 |
| 创建时间 | 文件创建时间 |
| 修改时间 | 最后修改时间 |
| 直接索引块 | 直接指向的数据块号列表（最多6个） |
| 一级间接索引 | 间接索引块号（0表示未使用） |
| 二级间接索引 | 双重间接索引块号（0表示未使用） |

**演示操作：**
```
操作步骤：
1. 在终端执行: touch test.txt
2. 在终端执行: echo "Hello World" > test.txt
3. 切换到磁盘面板
4. 点击"iNode列表"标签
5. 可以看到新增的iNode（通常是iNode #1）
6. 点击该iNode，查看直接索引块信息
7. 点击"块 #XX"按钮，查看数据块内容
```

---

## 三、缓冲区面板详解

### 3.1 面板位置
点击左侧导航栏的"缓冲区"按钮进入。

### 3.2 界面组成

**统计卡片区：**
| 统计项 | 含义 |
|--------|------|
| 命中次数 | 读取时数据在缓冲区中的次数 |
| 未命中 | 读取时数据不在缓冲区的次数 |
| 置换次数 | 缓冲区满时替换页面的次数 |
| 写回次数 | 脏页写回磁盘的次数 |

**缓冲页网格：**
- 16个方块，每个代表一个缓冲页
- 显示页号、对应的磁盘块号、状态

**页面状态颜色：**

| 颜色 | 状态 | 含义 |
|------|------|------|
| 灰色 | FREE | 空闲页，未装载数据 |
| 绿色 | CLEAN | 干净页，数据与磁盘一致 |
| 红色 | DIRTY | 脏页，数据已修改未写回 |

**命中率计算：**
```
命中率 = 命中次数 / (命中次数 + 未命中次数) × 100%
```

### 3.3 演示操作

**演示缓存命中：**
```
1. 在终端执行: touch file1.txt
2. 执行: echo "Test content" > file1.txt
3. 第一次执行: cat file1.txt  → 未命中+1（从磁盘读取）
4. 第二次执行: cat file1.txt  → 命中+1（从缓冲区读取）
5. 第三次执行: cat file1.txt  → 命中+1
6. 观察缓冲区面板：命中率从0%逐渐提升
```

**演示页面置换：**
```
1. 创建超过16个文件并读取
2. 观察"置换次数"增加
3. 观察置换日志显示哪些页被替换
```

**演示脏页写回：**
```
1. 执行: echo "content" > file.txt
2. 观察缓冲区出现红色DIRTY页
3. 执行: sync
4. 观察DIRTY页变为CLEAN或FREE
5. 观察"写回次数"增加
```

### 3.4 置换日志

底部显示最近的页面置换操作：
- 时间戳
- 操作类型（EVICT置换/LOAD加载/WRITEBACK写回）
- 涉及的页号和块号

---

## 四、进程面板详解

### 4.1 面板位置
点击左侧导航栏的"进程"按钮进入。

### 4.2 界面组成

**进程状态转换图：**
显示五态模型：
```
NEW → READY ⇄ RUNNING → TERMINATED
              ↓ ↑
            BLOCKED
```

每个状态显示当前处于该状态的进程数。

**进程列表表格：**

| 列名 | 含义 |
|------|------|
| PID | 进程ID，唯一标识符 |
| 进程名称 | 用户定义的名称，如"Task_1234" |
| 状态 | NEW/READY/RUNNING/BLOCKED/TERMINATED |
| 命令类型 | 演示任务(longtask)、ls、create等 |
| 优先级 | 进程优先级（默认0） |
| CPU时间 | 已使用的CPU时间（秒） |
| 操作 | 终止按钮 |

### 4.3 进程状态含义

| 状态 | 颜色 | 含义 |
|------|------|------|
| NEW | 灰色 | 刚创建，尚未加入调度 |
| READY | 橙色 | 就绪，等待CPU分配 |
| RUNNING | 绿色 | 正在CPU上执行 |
| BLOCKED | 红色 | 等待I/O或资源 |
| TERMINATED | 深灰 | 已执行完毕 |

### 4.4 演示操作

**创建测试进程：**
```
1. 点击"创建测试进程(ls)"按钮
2. 观察进程列表新增一个进程
3. 进程执行完毕后变为TERMINATED状态
```

**在终端创建进程：**
```
# 每个命令都会创建一个进程
touch file.txt  → 创建CREATE进程
cat file.txt    → 创建READ进程
rm file.txt     → 创建DELETE进程
```

---

## 五、调度器面板详解

### 5.1 面板位置
点击左侧导航栏的"调度器"按钮进入。

### 5.2 界面组成

**控制区：**
- 调度器状态：STOPPED/RUNNING/PAUSED
- 时间片设置：可调节时间片大小（10-1000ms）
- 控制按钮：启动/暂停/恢复/停止

**任务创建区：**
- "创建单个任务"：创建一个持续5秒的演示任务
- "批量创建(3个)"：同时创建3个任务

**统计信息：**

| 统计项 | 含义 |
|--------|------|
| 当前进程 | 正在运行的进程PID |
| 时间片使用 | 已使用的时间片数量 |
| 上下文切换 | CPU从一个进程切换到另一个进程的次数 |
| 抢占次数 | 时间片用完被强制切换的次数 |
| CPU利用率 | CPU使用率百分比 |

**就绪队列：**
显示等待执行的进程PID列表。时间片轮转特点：
- 新进程加入队列尾部
- 时间片用完的进程放回队列尾部
- 始终从队列头部取出进程执行

**调度事件日志：**
显示调度器的操作记录：
- dispatch：将进程分配到CPU
- preempt：时间片用完，抢占进程
- complete：进程执行完毕
- block/unblock：进程阻塞/解除阻塞

### 5.3 时间片轮转演示

**演示步骤：**
```
1. 点击"启动"按钮启动调度器
2. 点击"批量创建(3个)"创建3个任务
3. 观察就绪队列变化
4. 观察"当前进程"在不同PID间切换
5. 观察"上下文切换"和"抢占次数"增加
6. 观察调度事件日志中的dispatch和preempt事件
```

**调节时间片：**
```
1. 将时间片设为50ms，点击"设置"
2. 创建任务，观察切换更频繁
3. 将时间片设为500ms
4. 创建任务，观察每个进程运行更长时间
```

### 5.4 调度事件含义

| 事件类型 | 含义 |
|----------|------|
| dispatch | 调度器选中进程，分配CPU |
| preempt | 时间片用完，强制切换 |
| complete | 进程正常完成 |
| block | 进程等待I/O，进入阻塞 |
| unblock | I/O完成，进程回到就绪队列 |

---

## 六、终端面板详解

### 6.1 面板位置
点击左侧导航栏的"终端"按钮进入。

### 6.2 界面组成
- 终端输出区：显示命令历史和执行结果
- 命令输入行：输入命令的位置
- 清空按钮：清除终端内容

### 6.3 命令分类

详见《用户手册.md》中的命令参考部分。

### 6.4 演示流程

**完整演示脚本：**

```bash
# ===== 1. 磁盘和文件系统演示 =====
# 查看磁盘状态
df
dumpe2fs

# 创建文件
touch demo.txt
echo "Hello, OS Course Design!" > demo.txt

# 查看文件
ls
cat demo.txt
stat demo.txt

# 查看iNode
inode 1

# ===== 2. 目录操作演示 =====
mkdir projects
cd projects
pwd
touch project.txt
ls
cd ..

# ===== 3. 缓冲区演示 =====
# 查看缓冲区状态
free

# 触发缓存命中
cat demo.txt
cat demo.txt
cat demo.txt

# 再次查看，观察命中率
free

# 刷新缓冲区
sync

# ===== 4. 进程调度演示 =====
# 启动调度器
sched start

# 查看调度状态
top

# 创建演示任务
nice task1 5
nice task2 3
batch 3

# 观察调度
top
ps

# 调整时间片
sched quantum 50

# ===== 5. 共享内存演示 =====
# 查看IPC资源
ipcs

# 创建共享内存
shmget 256

# 写入数据
shmwrite 1 "Hello from Process A"

# 读取数据
shmread 1

# 查看资源
ipcs

# 清理
ipcrm 1

# ===== 6. 文件保护演示 =====
touch locked.txt
open locked.txt
rm locked.txt   # 失败：文件正在使用
close locked.txt
rm locked.txt   # 成功

# ===== 7. 清理 =====
rm demo.txt
ls
```

---

## 七、各面板之间的关联

### 7.1 文件操作时的变化

**当执行 `echo "Hello" > file.txt` 时：**

| 面板 | 变化 |
|------|------|
| 磁盘面板 | 位图中有新块变为已使用（橙色）；iNode列表增加新条目 |
| 缓冲区面板 | 出现DIRTY页（红色）；未命中次数增加 |
| 进程面板 | 短暂出现CREATE进程 |
| 终端面板 | 显示执行过程和结果 |

### 7.2 读取文件时的变化

**当执行 `cat file.txt` 时：**

| 面板 | 变化 |
|------|------|
| 缓冲区面板 | 第一次：未命中+1，出现CLEAN页；后续：命中+1 |
| 进程面板 | 出现READ进程 |
| 终端面板 | 显示文件内容 |

### 7.3 进程调度时的变化

**当创建多个任务时：**

| 面板 | 变化 |
|------|------|
| 调度器面板 | 就绪队列显示等待的PID；当前进程不断切换；上下文切换数增加 |
| 进程面板 | 进程状态在READY↔RUNNING间切换 |

### 7.4 删除文件时的变化

**当执行 `rm file.txt` 时：**

| 面板 | 变化 |
|------|------|
| 磁盘面板 | 已使用块变回空闲（灰色）；iNode消失 |
| 缓冲区面板 | 相关页可能被标记为无效 |
| 进程面板 | 出现DELETE进程 |

---

## 八、故障排除

### Q1: 界面不更新
**解决**：点击各面板的"刷新"按钮，或刷新整个页面

### Q2: 磁盘位图显示空白
**解决**：检查后端是否正常运行，刷新页面

### Q3: 缓冲区命中率始终为0%
**解决**：首次访问必定未命中，多次读取同一文件后命中率会提升

### Q4: 调度器创建的任务没有执行
**解决**：确保调度器已启动（状态为RUNNING）

### Q5: 进程状态一直是NEW
**解决**：这通常是调度器未启动，执行 `sched start`

---

## 九、截图要点

演示时需要截取的关键画面：

| 编号 | 画面 | 操作 |
|------|------|------|
| 1 | 初始磁盘位图 | 刚启动系统时的磁盘面板 |
| 2 | 创建文件后的位图 | 创建几个文件后，新块变色 |
| 3 | iNode详情 | 点击iNode显示混合索引结构 |
| 4 | 缓冲区命中演示 | 多次cat同一文件后的命中率 |
| 5 | DIRTY页 | 写入文件后的红色脏页 |
| 6 | 进程状态图 | 显示各状态进程数量 |
| 7 | 调度器运行中 | 多个任务在就绪队列轮转 |
| 8 | 调度事件 | dispatch和preempt事件记录 |

