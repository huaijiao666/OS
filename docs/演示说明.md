# 操作系统课程设计 - 功能演示说明

本文档将指导您逐步演示系统的所有功能，涵盖题目要求的各个方面。

## 一、启动系统

### 1.1 启动后端服务
```bash
cd backend
python app.py
```
后端将在 http://localhost:3456 启动

### 1.2 启动前端服务
```bash
cd frontend
npm install   # 首次运行需要
npm run dev
```
前端将在 http://localhost:5173 启动

### 1.3 打开浏览器
访问 http://localhost:5173 即可看到系统界面

---

## 二、文件系统演示（位图+索引方式）

### 2.1 基本文件操作

在终端面板输入以下命令：

```bash
# 1. 查看当前目录
pwd
# 输出: /

# 2. 列出目录内容
ls
# 输出: (空目录) 或已有文件列表

# 3. 创建文件（使用标准touch命令）
touch hello.txt

# 4. 使用echo写入内容（Linux标准重定向语法）
echo Hello World > hello.txt

# 5. 查看文件内容
cat hello.txt
# 输出: Hello World

# 6. 追加内容到文件
echo This is appended content >> hello.txt

# 7. 再次查看
cat hello.txt
# 输出: Hello World
#       This is appended content

# 8. 查看文件详细信息（使用stat命令）
stat hello.txt
# 显示: iNode号、大小、块数、权限、时间戳等
```

### 2.2 目录操作

```bash
# 创建目录
mkdir mydir

# 进入目录
cd mydir

# 确认当前路径
pwd
# 输出: /mydir

# 在子目录创建文件
touch subfile.txt
echo Content in subdir > subfile.txt

# 返回上级目录
cd ..

# 查看目录结构
ls
```

### 2.3 查看iNode和磁盘块

```bash
# 查看文件系统详细信息
dumpe2fs
# 显示: 块大小、总块数、iNode数量、磁盘布局等

# 列出所有使用中的iNode
inodes
# 显示: iNode ID、类型、大小

# 查看特定iNode详细信息（0是根目录）
inode 0
# 显示: 类型、权限、直接索引块、间接索引等

# 查看数据块内容（使用hexdump命令）
hexdump 35
# 显示: 块35的十六进制和ASCII内容
```

### 2.4 磁盘可视化面板

1. 点击左侧"磁盘"按钮进入磁盘面板
2. 观察位图显示：
   - 蓝色：超级块
   - 紫色：位图区
   - 橙色：iNode区
   - 红色：已使用数据块
   - 灰色：空闲块
3. 点击"iNode列表"标签查看所有iNode
4. 点击任意iNode查看详细信息
5. 点击"快速查看数据块"按钮查看关联的块内容

---

## 三、内存缓冲区演示（LRU页面置换）

### 3.1 查看缓冲区状态

```bash
# 使用free命令查看缓冲区
free
# 显示: 总页数、空闲页、脏页、命中率等
```

### 3.2 触发缓冲区操作

```bash
# 创建大文件触发多块读写
touch bigfile.txt
echo This is a test content that will span multiple blocks if long enough > bigfile.txt

# 多次读取观察命中率变化
cat bigfile.txt
cat bigfile.txt
cat bigfile.txt

# 再次查看缓冲区状态
free
# 注意命中次数和命中率的变化
```

### 3.3 同步缓冲区

```bash
# 将脏页写回磁盘
sync
```

### 3.4 缓冲区面板可视化

1. 点击左侧"缓冲区"按钮
2. 观察16个缓冲页的状态：
   - FREE（灰色）：空闲页
   - CLEAN（绿色）：干净页
   - DIRTY（红色）：脏页
3. 悬停在页面上查看详细信息
4. 点击"写回脏页"按钮将脏页同步到磁盘
5. 观察置换日志区域

---

## 四、进程管理演示（时间片轮转调度）

### 4.1 查看进程

```bash
# 查看当前进程列表
ps
# 显示: PID、状态、命令、CPU时间

# 使用top命令查看更详细信息
top
# 显示: 调度器状态、CPU利用率、进程列表
```

### 4.2 创建后台任务（演示调度）

```bash
# 创建单个后台任务（持续5秒）
nice task1 5
# 输出: [pid] task1 &

# 创建多个任务演示并发调度
batch 3
# 输出: 创建3个任务的PID

# 观察进程状态
ps

# 再次查看top观察调度
top
```

### 4.3 调度器控制

```bash
# 查看调度器当前状态
top

# 暂停调度器
sched pause

# 恢复调度器
sched resume

# 修改时间片大小（毫秒）
sched quantum 200

# 停止调度器
sched stop

# 启动调度器
sched start
```

### 4.4 终止进程

```bash
# 查看进程
ps

# 终止指定进程
kill <pid>
```

### 4.5 进程/调度器面板可视化

1. 点击"进程"面板查看进程状态转换图
2. 点击"调度器"面板：
   - 观察就绪队列变化
   - 查看调度事件日志
   - 点击"创建单个任务"或"批量创建"按钮
   - 修改时间片大小

---

## 五、共享内存演示（IPC通信）

### 5.1 创建和使用共享内存

```bash
# 查看当前IPC资源
ipcs
# 显示: 共享内存段列表

# 创建共享内存段（1024字节）
shmget 1024
# 输出: 创建成功，key=1

# 写入数据到共享内存
shmwrite 1 Hello from Process A

# 读取共享内存内容
shmread 1
# 输出: Hello from Process A

# 再次查看IPC资源
ipcs

# 删除共享内存段
ipcrm 1

# 确认删除
ipcs
```

### 5.2 共享内存同步演示

共享内存使用条件变量实现读写同步：
- 多个进程可以同时读取
- 写入时会等待所有读者和写者完成

---

## 六、文件保护演示（非阻塞I/O）

### 6.1 打开和关闭文件

```bash
# 创建测试文件
touch protected.txt
echo Test content > protected.txt

# 打开文件（设置文件锁）
open protected.txt
# 输出: 文件已打开

# 尝试删除已打开的文件
rm protected.txt
# 输出: 错误 - 文件正在被使用，无法删除

# 关闭文件
close protected.txt

# 现在可以删除了
rm protected.txt
```

---

## 七、可视化延时演示

### 7.1 观察文件操作延时

创建较大文件时，可以在磁盘面板观察块的分配过程：

1. 打开磁盘面板
2. 在终端创建文件：
   ```bash
   echo This is a long content that will be written block by block > test.txt
   ```
3. 观察位图中新块的标记过程
4. 注意WebSocket推送的file_progress事件

### 7.2 观察缓冲区置换

1. 打开缓冲区面板
2. 连续读取多个不同文件
3. 观察页面状态变化和置换日志

---

## 八、磁盘格式化

```bash
# 警告：这会清除所有数据！
mkfs --force
# 输出: filesystem created successfully

# 确认磁盘已清空
ls
df
inodes
```

---

## 九、完整演示流程

按以下顺序进行完整演示：

### 第一部分：文件系统（5分钟）
1. `pwd` → `ls` → 确认初始状态
2. `touch file1.txt` → 创建文件
3. `echo Hello > file1.txt` → 写入内容
4. `cat file1.txt` → 读取内容
5. `stat file1.txt` → 查看iNode信息
6. `mkdir dir1` → `cd dir1` → 目录操作
7. `inode 0` → `inodes` → 查看iNode
8. `hexdump 35` → 查看块内容
9. `dumpe2fs` → 查看文件系统结构

### 第二部分：缓冲区（3分钟）
1. `free` → 查看初始状态
2. 多次 `cat file1.txt` → 触发缓存
3. `free` → 观察命中率提升
4. `sync` → 同步脏页
5. 在缓冲区面板观察页面状态

### 第三部分：进程调度（5分钟）
1. `ps` → `top` → 查看初始状态
2. `nice task1 5` → 创建单个任务
3. `batch 3` → 创建批量任务
4. `ps` → 观察进程状态
5. `sched quantum 200` → 修改时间片
6. `jobs` → 查看后台任务
7. `kill <pid>` → 终止进程
8. 在调度器面板观察就绪队列和事件日志

### 第四部分：共享内存（3分钟）
1. `ipcs` → 查看初始状态
2. `shmget 1024` → 创建共享内存
3. `shmwrite 1 Test Data` → 写入
4. `shmread 1` → 读取
5. `ipcs` → 确认创建成功
6. `ipcrm 1` → 删除

### 第五部分：文件保护（2分钟）
1. `touch locked.txt`
2. `open locked.txt`
3. `rm locked.txt` → 失败
4. `close locked.txt`
5. `rm locked.txt` → 成功

---

## 十、命令速查表

| 类别 | 命令 | 说明 |
|------|------|------|
| 文件 | `ls` | 列出目录 |
| | `pwd` | 当前路径 |
| | `cd <dir>` | 切换目录 |
| | `mkdir <dir>` | 创建目录 |
| | `touch <file>` | 创建空文件 |
| | `cat <file>` | 查看内容 |
| | `echo <text> > <file>` | 写入文件 |
| | `echo <text> >> <file>` | 追加文件 |
| | `rm <file>` | 删除文件 |
| | `stat <file>` | 文件信息 |
| | `open/close <file>` | 打开/关闭 |
| 磁盘 | `df` | 磁盘使用 |
| | `free` | 缓冲区状态 |
| | `sync` | 同步缓冲 |
| | `mkfs --force` | 格式化 |
| | `hexdump <id>` | 查看块 |
| | `inode <id>` | 查看iNode |
| | `inodes` | 列出iNode |
| | `dumpe2fs` | 文件系统信息 |
| 进程 | `ps` | 进程列表 |
| | `top` | 调度状态 |
| | `kill <pid>` | 终止进程 |
| | `nice <name> [s]` | 创建任务 |
| | `batch <n>` | 批量任务 |
| | `jobs` | 后台任务 |
| 调度 | `sched start/stop` | 控制调度器 |
| | `sched pause/resume` | 暂停/恢复 |
| | `sched quantum <ms>` | 设置时间片 |
| IPC | `ipcs` | IPC列表 |
| | `shmget <size>` | 创建共享内存 |
| | `shmread <key>` | 读取 |
| | `shmwrite <k> <d>` | 写入 |
| | `ipcrm <key>` | 删除 |
| 其他 | `clear` | 清屏 |
| | `history` | 命令历史 |
| | `help` | 帮助 |

---

## 十一、题目要求对照表

| 题目要求 | 实现方式 | 演示命令 |
|----------|----------|----------|
| 位图管理 | 位示图法管理空闲块 | `df`, 磁盘面板 |
| 索引方式 | 混合索引(直接+间接) | `inode`, `dumpe2fs` |
| 非阻塞I/O | 立即返回，不等待 | `open`, `close` |
| 共享内存 | IPC共享内存通信 | `ipcs`, `shmget` |
| 条件变量 | 读写同步控制 | 查看源码process.py |
| 时间片轮转 | RR调度算法 | `top`, `sched` |
| 缓冲区管理 | LRU页面置换 | `free`, 缓冲区面板 |
| 可视化延时 | IO_DELAY配置 | 观察磁盘面板动态变化 |

---

*文档结束*

